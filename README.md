# izuna-elastic-monitor
Page for monitor elasticsearch status



## Allocation Explain

1. Назначение
Блок предназначен для анализа причин, по которым определённый шард (или случайный нераспределённый шард) не может быть размещён в кластере Elasticsearch. Это помогает быстро понять, почему некоторые шарды остаются unassigned или не могут быть перемещены.

2. Интерфейс пользователя
Кнопка "Случайный шард" — отправляет запрос на explain для случайного нераспределённого шарда (если такие есть).
Поля ввода:
Индекс — имя индекса, для которого вы хотите проанализировать шард.
Шард — номер шарда.
primary (чекбокс) — если отмечено, анализируется primary-шард, иначе — реплика.
Кнопка "Анализировать конкретный шард" — отправляет запрос на explain для выбранного шарда.

3. Как работает логика
    - При нажатии на любую из кнопок вызывается функция fetchAllocation.
    - Если указаны параметры (индекс, шард, primary), отправляется POST-запрос на `/_cluster/allocation/explain` с телом:
    ```json
    {
    "index": "имя_индекса",
    "shard": номер_шарда,
    "primary": true/false
    }
    ```
    - Если параметры не указаны — отправляется GET-запрос на тот же endpoint (или POST без тела), чтобы получить explain для случайного нераспределённого шарда.

4. Обработка ответа
    - Если сервер возвращает успешный ответ, он отображается в виде prettified JSON.
    - Если сервер возвращает ошибку 400 с текстом, что нет нераспределённых шардов (или с reason, содержащим "No shard was specified in the request which means the response should explain a randomly-chosen unassigned shard, but there are no unassigned shards in this cluster"), выводится сообщение:
    ```text
    "Нет нераспределенных шардов для анализа"
    ```
    - Если ошибка другая — выводится текст ошибки.

5. Примеры использования
    - Диагностика проблем с размещением шардов:
    Можно быстро узнать, почему шард не назначается (например, нехватка места, ограничения по allocation, отключённые ноды и т.д.).
    - Анализ конкретного шарда:
    Можно вручную указать индекс, номер шарда и тип (primary/replica) для анализа конкретной ситуации.

6. Технические детали
    - Для POST-запроса используется публичный метод сервиса `getAllocationExplainWithBody`.
    - Ответы сервера обрабатываются с учётом специфики ошибок Elasticsearch.
    - UI реагирует на загрузку, ошибки и успешные ответы.
